<p align="center"><img src="https://i.ibb.co/xz62C9w/Main-logo.png" alt="Main-logo" border="0" width="300"></p>

<p align="center">
   <img src="https://img.shields.io/badge/Pyhton-3.12-orange)" alt="Python Version">
   <img src="https://img.shields.io/badge/Django-5.2-E86F00" alt="Django Version">
   <img src="https://img.shields.io/badge/DRF-3.16.0-blue"
   alt="DRF">
</p>

<p>Web-приложение обеспечивающее возможность онлайн записи клиентов на услуги автомоечного комплекса и администрирования работы компании.</p>

Рабочую версию сайта вы можете на [https://aquamarine-pro.ru](https://aquamarine-pro.ru)

## Описание работы приложения
Сайт состоит из четырёх независимых интерфейсов. 

* Публичная часть
* Интерфейс менеджера
* Интерфейс администратора
* API 

### Публичная часть:
Главная страница сайта, где можно узнать о работе компании и её преимуществах перед конкурентами, заказать звонок от компании. 


<a href="https://ibb.co/cYbFHt3"><img src="https://i.ibb.co/0sBMSZ2/2023-12-11-14-45-34.png" alt="head" border="0"></a>

Также можно ознакомиться с прайсом услуг компании.<br>
Цены на услуги в прайс-листе, обновляются с изменениями цен администратором в админ-панели.

<a href="https://ibb.co/zRsYtkY"><img src="https://i.ibb.co/hWsjTqj/2023-12-11-14-44-19.png" alt="price" border="0"></a>

В нижней части находится интерактивная Яндекс карта с месторасположением автомоечного комплекса и футер с контактными данными. 

<a href="https://ibb.co/XVm8qxs"><img src="https://i.ibb.co/b7pJk5B/2023-12-11-15-12-50.png" alt="footer" border="0"></a>

После авторизации пользователя, в зависимости от прав доступа, будет формироваться выпадающее меню

<a href="https://ibb.co/R9GdS4z"><img src="https://i.ibb.co/PNs0Yzw/2023-12-11-16-41-14.png" alt="header" border="0"></a>
<p align="center">
<img src="https://i.ibb.co/8zBZCK4/menu1.png" alt="menu1" border="0">
<img src="https://i.ibb.co/ZcskyfV/menu2.png" alt="menu2" border="0">
<img src="https://i.ibb.co/MnHXS6H/menu3.png" alt="menu3" border="0"></p>

В "**Профиле**" пользователь может изменять свои данные, пароль, кроме логина и индивидуального прайса на автомобиль.<br>
В "**Мои записи**" пользователь может посмотреть информацию о своих записях на автомойку и отменить их в случае необходимости.

<p align="center">
<img src="https://i.ibb.co/rcGM93Z/2023-12-11-17-26-33.png" alt="profile" border="0" width="350">
<img src="https://i.ibb.co/DV7Nv3C/2023-12-11-17-24-56.png" alt="user registrations" border="0" width="350">
</p>

Предусмотрена возможность восстановления пароля пользователя через электронную почту.

<p align="center">
<img src="https://i.ibb.co/mv0MDL6/2024-04-12-19-05-54.png" alt="login" border="0" width="350">
<img src="https://i.ibb.co/10p3Jdg/2024-04-12-19-06-19.png" alt="reset password" border="0" width="350">
</p>

Вкладка "Доступное время" показывает свободные дни и время с учётом выбранных услуг, а также общее время работ и их стоимость.<br>
Цены на услуги отображаются в зависимости от категории автомобиля клиента (седан/хетчбек, кроссовер или внедорожник).<br>
Время, которое уже прошло, автоматически становится недоступным для записи.

<p><img src="https://i.ibb.co/17fK1R4/2023-12-11-16-09-47.png" alt="page registrations" border="0"></p>

В случае успешной записи будет соответствующее уведомление.<br>
Но если время, которое выбрал пользователь уже занято, пока он регистрировал запись, то появится уведомление с предложением выбрать другое время.

<p align="center">
<img src="https://i.ibb.co/LhbLc2z/2023-12-11-17-23-51.png" alt="registrations done" border="0" width="350">
<img src="https://i.ibb.co/CMSVN82/2023-12-11-19-15-45.png" alt="registrations error" border="0" width="350">
</p>

У пользователей с правами менеджера или администратора, при записи на услуги, появляются поля для изменения марки и модели автомобиля, телефона и имени. Так как многие клиенты записываются по телефону указывая свои контактные данные.
Также появляется вкладка "**Менеджер**" для быстрого перехода к интерфейсу менеджера для администрирования записей клиентов.

<p><img src="https://i.ibb.co/r4wr00H/2023-12-11-16-16-08.png" alt="manager registration" border="0"></p>

### Интерфейс менеджера:
Предназначен для менеджера или администратора. Здесь менеджер получает полную информация на выбранный день (какой автомобиль, какие выбраны услуги и контакты клиента).
Записи выводятся на текущий день, а также на ближайшие 2 дня.<br>
Страница автоматически обновляет данные при появлении новой записи или заявки на звонок.
Обновление происходит с использованием протокола Websocket и signals.

<p><img src="https://i.ibb.co/VHWbQj3/2023-12-11-17-54-14.png" alt="manager interface" border="0"></p>

Также на странице отображена кнопка "**Запросы звонка**" которая начинает сигнализировать миганием, при поступлении запроса звонка от клиента. Кнопка перестаёт мигать, когда все телефонные звонки будут обработаны менеджером.
<p><img src="https://i.ibb.co/BVvRbxY/2023-12-11-19-38-17.png" alt="request call widget" border="0"></p>

### Интерфейс администратора:
Вкладка **"Админ - панель"** в выпадающем меню пользователя. Сюда имеет доступ только администратор.
Для обновления услуг и их цен, регистрации новых пользователей, для просмотра истории всех записей клиентов, в течение года.

В связи с пожеланием заказчика сайта, регистрация новых пользователей возможна только непосредственно администратором.

## Запуск сервера:

### Локально в Docker контейнере 

- Склонируйте репозиторий:
```
git clone https://github.com/SwedL/aquamarine.git
```
 - Перейдите в каталог проекта
```
cd aquamarine
```
- Установите переменные окружения. Создайте файл .env и скопируйте содержимое из .env.dev.example, подставьте свои значения.
- Запустите контейнеры.
```
docker compose up --build
```
Создайте модель суперпользователя
- Войдите в терминал контейнера с помощью команды:
```
docker exec -it project bash
```
- Создайте суперпользователя (<ins>login: эл.почта</ins>):
```
python3 manage.py createsuperuser
```

### На удалённом сервере в Docker контейнере 

- Склонируйте репозиторий в директорию /home:
```
git clone https://github.com/SwedL/aquamarine.git
```
 - Перейдите в каталог проекта
```
cd aquamarine
```
- Установите переменные окружения. Создайте файл .env и скопируйте содержимое из .env.prod.example, подставьте свои значения.
- Создайте директории для certbot, выполнив:
```
mkdir -p certbot/conf
mkdir certbot/www
```
- Измените в docker-compose.prod.yml в строке 76 ваш <ins>email</ins> и <ins>ваш домен</ins>, для получения SSL-сертификата от Let's Encrypt
- Перейдите в директорию nginx/prod/default.conf и в строках 4, 17, 19, 20 установите значение <ins>вашего домена</ins>
- Запустите контейнеры.
```
docker compose -f docker-compose.prod.yml up --build
```
Создайте модель суперпользователя
- Войдите в терминал контейнера с помощью команды:
```
docker exec -it project bash
```
- Создайте суперпользователя (<ins>login: эл.почта</ins>):
```
python3 manage.py createsuperuser
```

## Структура проекта
Проект организован в соответствии с принципами слоистой архитектуры. Архитектура проекта:

```
aquamarine/
├── nginx/               # Директория конфигурационных файлов обратного прокси сервера           
│   └── ...   
└── project/             # Директория Django проекта
    ├── api/             # API endpoints
    │   └── carwash/   
    │       ├── services/  # Сервисы API - выполняют операции над данными    
    │       ├── use_cases/ # Юзкейсы API - бизнес-логика на уровне сценариев использования   
    │       └── ...   
    ├── aquamarine/      # Django проект aquamarine
    │   └── ... 
    ├── carwash/         # Приложение carwash
    │   ├── exceptions   # Исключения
    │   ├── fixtures/    # Начальные данные для заполнения БД
    │   ├── services/    # Сервисы - выполняют операции над данными
    │   ├── tests/       # Тесты шаблонов, форм, представлений
    │   ├── use_cases/   # Юзкейсы - бизнес-логика на уровне сценариев использования
    │   ├── consumers.py # Обработка асинхронных событий websocket соединений
    │   ├── models.py    # Модели приложения
    │   ├── routing.py   # Маршрутизация асинхронных событий websocket соединений
    │   ├── serializers.py # Сериализаторы моделей приложения и входных данных API
    │   └── ...
    ├── common/          # Общие классы, методы, объекты
    │   └── utils.py     
    ├── templates/       # Шаблоны для собственной настройки интерфейса администратора
    ├── users/           # Приложение users
    │   ├── permissions/ # Разрешения для пользователей
    │   ├── tests        # Тесты шаблонов, форм, представлений
    │   ├── models.py    # Модели приложения
    │   ├── serializers.py # Сериализаторы моделей приложения
    │   └── ...
    ├── Dockerfile    
    ├── manage.py    
    └── pyproject.toml   # Конфигурация Poetry    
```

### Документация:
Документация API доступна по адресу: http://localhost:8000/swaggerui/

### Тестирование

Проект покрыт различными тестами, которые проверяют его работоспособность.<br>
При локальном запуске тесты запускаются командой:
```
python manage.py test
```
При запуске в Docker контейнере предварительно войдите в терминал контейнера:
```
docker exec -it project bash
```

## Автор проекта

* **Осминин Алексей** - [SwedL](https://github.com/SwedL)
