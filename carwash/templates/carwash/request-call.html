{% extends 'carwash/base.html' %}

{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'carwash/css/request-call.css' %}" xmlns="http://www.w3.org/1999/html">
{% endblock %}

{% block content %}
    <div class="space_background">
            <div class="login-data">
                <div class="login-data__content row justify-content-center">
                    <div class="col-lg-5">
                        <div class="card">
                            <div class="card-header"><h3 class="text-center font-weight-light my-4">Введите номер телефона</h3>
                            </div>
                            <div class="card-body">
                                <form method="post">
                                    {% csrf_token %}
                                     {% for field in form %}
                                        <div class="form-error__phone">{{ field.errors }}</div>
                                        <div class="form-group__phone">{{ field }}</div>
                                    {% endfor %}
                                    <div class="d-grid gap-2">
                                        <input id="chat-message-submit" class="btn btn-primary" type="submit" value="Заказать Звонок">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{%block script%}
    <script>
        base_url = `${window.location.host}${window.location.pathname}`
        const chatSocket = new WebSocket(`ws://${base_url}`);

        chatSocket.onopen = function(e) {
        console.log("connected")
        };

        chatSocket.onclose = function (e) {
            console.error('Chat socket closed unexpectedly');
        };

        document.querySelector('#chat-message-submit').onclick = function (e) {
            chatSocket.send(JSON.stringify({
                'type': 'text_message',
                'author': `{{request.user}}`,
                'message': 'update_date'
            }));
        };
    </script>
{% endblock script %}