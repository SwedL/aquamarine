{% extends 'carwash/base.html' %}

{% load static %}


{% block css %}
    <link rel="stylesheet" href="{% static 'carwash/css/staff.css' %}">
    <script src="{% static 'carwash/js/script.js' %}"></script>
{% endblock %}

{% block staff %}
    <script>
        setTimeout(function(){
        location.reload();
        }, 300000);
    </script>
{% endblock %}

{% block content %}
    <main>
        <div class="space_background">
            <div class="workday-page">
                <div class="workday-page__button">
                    <a href="{% url 'carwash:staff' days_delta=0 %}">
                        <button id="page1" type="submit" style="cursor:default" {% if days_delta == 0 %} disabled {% endif %}>
                            Сегодня<br>{{button_date.today}}
                        </button>
                    </a>
                </div>
                <div class="workday-page__button">
                    <a href="{% url 'carwash:staff' days_delta=1 %}">
                        <button id="page2" type="submit" style="cursor:default" {% if days_delta == 1 %} disabled {% endif %}>
                            Завтра<br>{{button_date.tomorrow}}
                        </button>
                    </a>
                </div>
                <div class="workday-page__button">
                    <a href="{% url 'carwash:staff' days_delta=2 %}">
                        <button id="page3" type="submit" style="cursor:default" {% if days_delta == 2 %} disabled {% endif %}>
                            Послезавтра<br>{{button_date.after_tomorrow}}
                        </button>
                    </a>
                </div>
            </div>
            <div class="data-box">
                <div class="request-call-box dropdown-center">
                    <botton class="btn request-call-box__button" {% if attention %} style="animation:myfirst 1s infinite;" {% endif %} role="button" id="dropdownMenuLink" {% if request_calls %} data-bs-toggle="dropdown" {% endif %}>
                        запросы звонка
                    </botton>
                    <ul class="dropdown-menu">
                        {% for call in request_calls %}
                            <li class="dropdown-item">{{call}}

                                {% if not call.processed %}
                                <a class="time-workday__cancel-button" href="{% url 'carwash:request_call_processing' days_delta call.pk %}">
                                    обработать</a>
                                {% endif %}
                            </li>
                            {% if not forloop.last %}
                                <li><hr class="dropdown-divider"></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                {% for time_workday in full_list_registrations_workday %}
                <div class="time-workday">
                    <div class="data-box__item time-workday__time {% if time_workday.free %} free time-workday__time-free {% else %} busy time-workday__time-busy {% endif %}">{{time_workday.time}}</div>
                    {% if time_workday.registration %}
                    <div class="data-box__item busy client-busy">{{time_workday.registration.client}}</div>
                    <div class="data-box__item busy time-workday__services">{{time_workday.registration.all_services}}</div>
                    <div class="time-workday__button">

                    <!-- Кнопка-триггер модального окна -->
                    <button type="button" class="time-workday__cancel-button" data-bs-toggle="modal" data-bs-target="#{{time_workday.registration.pk}}{{time_workday.time}}">
                        Отменить</button>

                        <!-- Модальное окно -->
                    <div class="modal fade" id="{{time_workday.registration.pk}}{{time_workday.time}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                            <div class="modal-header">
                            <!-- <h1 class="modal-title fs-5" id="exampleModalLabel">Заголовок модального окна</h1> -->
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                            </div>
                            <div class="modal-body">
                            <p class="modal-content__body-text" id="exampleModalLabel">Подтвердите удаление записи</p>
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                            <a href="{% url 'carwash:cancel' days_delta time_workday.registration.pk time_workday.time %}"><button type="button" class="btn btn-primary">Подтвердить</button></a>
                            </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    {% else %}
                    <div class="data-box__item {% if time_workday.free %} free client-free {% else %} busy client-busy {% endif %}">{{time_workday.client}}</div>
                    <div class="data-box__item time-workday__services {% if time_workday.free %} free {% else %} busy {% endif %}"></div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
{% endblock %}